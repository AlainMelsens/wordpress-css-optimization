O10N[1](function(D,a,F,K,e,m){function G(){var b=a("#critical_css_conditions_container").data("file");try{var l=p.get()}catch(c){return void e[51]("error","Failed to parse condition JSON: "+c.message,!1,!0,function(){})}var d=a('<span class="spinner"></span>');d.insertAfter(a("#critical_css_conditions_container .cancel"));d.css("visibility","visible");d={};d.file=b;d.conditions=JSON.stringify(l);e[24]("critical_css_save_conditions",d,function(c,d,g){if(a("#critical_css_conditions_container .spinner").remove(),
c)e[51]("error",c,!1,!0,function(){}),e[11]("","failed to delete",b,c);else if(r(),c=b.replace(/\.json$/,".css"),c=a('#critical-css-files tr[data-file="'+c+'"]'),c.length){if(c.data("conditions",g&&g[0]?g[0]:""),g[0])1===g[0].length?a(".conditions span",c).html(m[28]):a(".conditions span",c).html(m[29].replace("%d",g[0].length)),g=JSON.stringify(g[0]),50<g.length&&(g=g.substr(0,40)+"&hellip;]"),a(".conditions .json",c).html(g);a("html, body").animate({scrollTop:c.offset().top-50},200)}})}function H(){a(this);
var b=a(this).closest("tr");if(b.hasClass("edit_conditions"))return r(b);r();var l=b.data("file")||"",d=b.data("conditions"),c=l.replace(/\.css$/,".json");a("#critical-css-files tr").removeClass("edit_conditions");b.addClass("edit_conditions");a("td.options a.conditions",b).addClass("button-green");a("#critical_css_conditions_container").show();a("#critical_css_conditions_container").data("file",c);a("#critical_css_conditions_container .subhead .file").html(c);a("html, body").animate({scrollTop:a("#critical_css_conditions_container").offset().top-
150},200);e[55](function(b){e[15](function(){a("#critical_css_conditions").html("");var g,h={name:c,mode:"code",modes:["code","tree"],onError:function(a){e[11]("","JSON",a.toString());alert("JSON error. Please verify your input.\n\nSee console for details.")},onChange:function(){try{var b=p.get()}catch(L){return}a("#critical_css_conditions_src").val(JSON.stringify(b))},onModeChange:function(a){"tree"===a&&p.expandAll()},search:!1,schema:e[4]("css.critical.conditions"),ajv:e[59]};if(d)if("string"==
typeof d)try{g=JSON.parse(d)}catch(z){g=[]}else g=d;else g=[];(p=new b(a("#critical_css_conditions")[0],h,g)).compact();p.aceEditor.setOptions({autoScrollEditorIntoView:!0,maxLines:1/0});p.focus();a("#critical_css_conditions_src").data("json-editor",p)})})}function r(b){b||(b=a("#critical-css-files tr"));b.removeClass("edit_conditions");a("td.options a.conditions",b).removeClass("button-green");a("#critical_css_conditions_container").hide()}function I(){var b=a(this),l=a(this).closest("tr"),d=l.data("file");
l.addClass("delete");e[15](function(){setTimeout(function(){if(confirm(m[24])){r();var c=a('<span class="spinner"></span>');b.replaceWith(c);c.css("visibility","visible");c={};c.file=d;c.files=JSON.stringify(t());e[24]("critical_css_delete_file",c,function(b){b?(e[51]("error",b,!1,!0,function(){}),e[11]("","failed to delete",d,b)):(a('tr[rel="'+d+'"]',a("#critical-css-files")).remove(),C(function(){var b=t();b instanceof Array||(b=[]);for(var c=b.length,e=0;e<c;e++)b[e]&&b[e].file===d&&b.splice(e,
1);a('input[name="o10n[css.critical.files]"]').val(JSON.stringify(b));q()}))})}else l.removeClass("delete")})})}function x(){var b=a("#add_critical_css_file_form .submit"),l=a(this).hasClass("add-edit"),d=a("#add_critical_css_file_form"),c={};if(c.file=a("input.file",d).val(),c.title=a("input.title",d).val(),c.priority=a("input.priority",d).val(),c.files=JSON.stringify(t()),""!==a.trim(c.file)){if(!/^[a-zA-Z0-9\-\_]+(\.css)?$/.test(c.file))return a(".add_critical_file input.file").focus(),void e[61](b,
a("input.file",d).data("invalid"));if(/^[a-zA-Z0-9\-\_]+\.css$/.test(c.file)||(c.file+=".css"),""===a.trim(c.priority)||isNaN(parseInt(c.priority))||1>parseInt(c.priority))return a("input.priority",d).focus(),void e[61](b,a("input.priority",d).data("invalid"));a("button",d).prop("disabled",!0);var n=setTimeout(function(){a(".add_critical_file button").prop("disabled",!1);a("button").prop("disabled",!1)},3E3);e[61](b,m[21]);e[62](b);e[24]("critical_css_add_file",c,function(g,h,z){if(e[62](b,!0),a("button",
d).prop("disabled",!1),n&&clearTimeout(n),g)e[51]("error",g,!1,!0,function(){}),e[11]("","failed to save",c,g);else{if(h)return void e[61](b,h);a("input.file",d).val("");a("input.title",d).val("");a("input.priority",d).val("");a("input.file",d).blur();e[61](b,m[22],3E3);C(function(){if(l){if(z&&z[1]){var b=a('#critical-css-files tr[data-file="'+z[1]+'"] a.edit').attr("href");document.location.href=b}}else q(),a("#add_critical_css_file_form").hide()})}})}else a("input.file",d).focus()}function J(){if(u){for(var b,
e=u,d=document.createDocumentFragment(),c=e.length,n=0;n<c;n++){if(criticalCssParams=e[n],criticalCssParams.error)(b=a(v.cloneNode(!0).firstElementChild)).attr("data-type","error"),b.attr("data-file",criticalCssParams.filepath),a(".title",b).html(criticalCssParams.title?criticalCssParams.title:criticalCssParams.file),a(".error",b).html(criticalCssParams.error),a(".filepath",b).html(criticalCssParams.filepath);else{if(criticalCssParams.file)(b=a(A.cloneNode(!0).firstElementChild)).attr("data-type",
"file"),b.attr("data-file",criticalCssParams.filepath),a(".edit",b).attr("href",criticalCssParams.edit_url),a(".title",b).html(criticalCssParams.title?criticalCssParams.title:criticalCssParams.file),a(".title",b).attr("href",criticalCssParams.edit_url),a(".filepath",b).html(criticalCssParams.filepath),a(".date",b).html(criticalCssParams.date),a(".size span",b).html(criticalCssParams.hsize);else{if(!criticalCssParams.V)continue;(b=a(B.cloneNode(!0).firstElementChild)).attr("data-type","auto");b.attr("data-file",
criticalCssParams.filepath);b.attr("data-auto",JSON.stringify(void 0));a(".title",b).html(criticalCssParams.title?criticalCssParams.title:criticalCssParams.file);a(".error",b).html(criticalCssParams.error)}a(".priority input",b).val(criticalCssParams.priority);a(".priority input",b).attr("name","o10n[sort]["+criticalCssParams.file+"]")}if(criticalCssParams.conditions){b.attr("data-conditions",JSON.stringify(criticalCssParams.conditions));1===criticalCssParams.conditions.length?a(".conditions span",
b).html(m[28]):a(".conditions span",b).html(m[29].replace("%d",criticalCssParams.conditions.length));var g=JSON.stringify(criticalCssParams.conditions);50<g.length&&(g=g.substr(0,40)+"&hellip;]");a(".conditions .json",b).html(g)}a(d).append(b)}a("#critical-css-files tr").remove();a("#critical-css-files").append(d)}}function C(b){var l={files:0};e[24]("critical_css_files_list",l,function(d,c,n){d?(e[51]("error",d,!1,!0,function(){}),e[11]("","failed to save",l,d)):(u=n[0],a('input[name="o10n[css.critical.files]"]').val(JSON.stringify(n[1])),
J(),b&&b())})}function q(b){var e=t();if(e instanceof Array||(e=[]),0===a("#critical-css-files tr").length)a("#critical-css-files-empty").show();else{if(a("#critical-css-files-empty").hide(),b)if(h=parseInt(b.val()),!isNaN(h)){var d=b.closest("tr"),c=d.prev(),d=d.next(),n=!1;c.length&&(g=parseInt(a(".priority input",c).val()),isNaN(g)||h!==g||(a(".priority input",c).val(h+1),a(b).val(g),n=!0));!n&&d.length&&(c=parseInt(a(".priority input",d).val()),isNaN(c)||h!==c||(a(".priority input",d).val(h+1),
b.val(c)))}b=a("#critical-css-files tr").get();b.sort(function(b,c){var d=parseInt(a(".priority input",b).val()),e=parseInt(a(".priority input",c).val());return isNaN(d)&&(d=1),isNaN(e)&&(e=1),d===e?0:d<e?-1:1});a.each(b,function(b,c){a("#critical-css-files").append(c)});var g=0;a("#critical-css-files tr").each(function(b,c){var d=parseInt(a(".priority input",c).val());isNaN(d)&&(d=1);d<=g&&(d=g+1,a(".priority input",c).val(d));g=d});var h;b=e.length;for(c=0;c<b;c++)e[c].file&&(h=parseInt(a('#critical-css-files tr[data-file="'+
e[c].file+'"] .priority input').val()),isNaN(h)||(e[c].priority=h));e.sort(function(a,b){return isNaN(a.priority)&&(a.priority=1),isNaN(b.priority)&&(b.priority=1),a.priority===b.priority?0:a.priority<b.priority?-1:1});a('input[name="o10n[css.critical.files]"]').val(JSON.stringify(e))}}function t(){var b=a('input[name="o10n[css.critical.files]"]').val();if(b)try{return JSON.parse(b)}catch(l){}return[]}!function(a,e,d,c){function b(a,b){return Math.max(0,a[0]-b[0],b[0]-a[1])+Math.max(0,a[2]-b[1],b[1]-
a[3])}function g(f,b,c,d){var k=f.length;d=d?"offset":"position";for(c=c||0;k--;){var y=f[k].el?f[k].el:a(f[k]),e=y[d]();e.left+=parseInt(y.css("margin-left"),10);e.top+=parseInt(y.css("margin-top"),10);b[k]=[e.left-c,e.left+y.outerWidth()+c,e.top-c,e.top+y.outerHeight()+c]}}function h(a,b){var f=b.offset();return{left:a.left-f.left,top:a.top-f.top}}function l(a,c,d){c=[c.left,c.top];d=d&&[d.left,d.top];for(var f,k=a.length,e=[];k--;)f=a[k],e[k]=[k,b(f,c),d&&b(f,d)];return e=e.sort(function(a,f){return f[1]-
a[1]||f[2]-a[2]||f[0]-a[0]})}function m(f){this.options=a.extend({},w,f);this.containers=[];this.options.a||(this.scrollProxy=a.proxy(this.scroll,this),this.dragProxy=a.proxy(this.drag,this),this.dropProxy=a.proxy(this.drop,this),this.placeholder=a(this.options.placeholder),f.isValidTarget||(this.options.isValidTarget=c))}function p(f,b){this.el=f;this.options=a.extend({},r,b);this.group=m.get(this.options);this.a=this.options.a||this.group;this.handle=this.a.options.handle||this.a.options.itemSelector;
var c=this.a.options.itemPath;this.target=c?this.el.find(c):this.el;this.target.on(u.start,this.handle,a.proxy(this.o,this));this.options.drop&&this.group.containers.push(this)}var r={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},w={afterMove:function(){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(){return!0},onCancel:function(){},onDrag:function(a,b){a.css(b)},onDragStart:function(f,
b){f.css({height:f.outerHeight(),width:f.outerWidth()});f.addClass(b.group.options.draggedClass);a("body").addClass(b.group.options.bodyClass)},onDrop:function(f,b){f.removeClass(b.group.options.draggedClass).removeAttr("style");a("body").removeClass(b.group.options.bodyClass)},onMousedown:function(a,b,c){if(!c.target.nodeName.match(/^(input|select|textarea)$/i))return c.preventDefault(),!0},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function(f,
b,c){f=a.extend({},f.data());return c?[b]:(b[0]&&(f.children=b),delete f.W,delete f.sortable,f)},tolerance:0},q={},t=0,x={left:0,top:0,bottom:0,right:0},u={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"};m.get=function(a){return q[a.group]||(a.group===c&&(a.group=t++),q[a.group]=new m(a)),q[a.group]};m.prototype={o:function(f,b){this.K=a(b.el[0].ownerDocument);var c=
a(f.target).closest(this.options.itemSelector);c.length&&(this.item=c,this.G=b,!this.item.is(this.options.exclude)&&this.options.onMousedown(this.item,w.onMousedown,f))&&(this.I(f),this.J("on"),this.U(),this.C=!0)},drag:function(a){if(!this.s){if(!this.M(a)||!this.m)return;this.options.onDragStart(this.item,this.G,w.onDragStart,a);this.item.before(this.placeholder);this.s=!0}this.I(a);this.options.onDrag(this.item,h(this.b,this.item.offsetParent()),w.onDrag,a);a=this.v(a);var f=this.h,b=this.options.tolerance;
(!f||f.top-b>a.top||f.bottom+b<a.top||f.left-b>a.left||f.right+b<a.left)&&(this.i()||(this.placeholder.detach(),this.w=c))},drop:function(a){this.J("off");this.C=!1;this.s&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.G,w.onCancel,a),this.options.onDrop(this.item,this.N(this.item),w.onDrop,a),this.A(),this.B(),this.w=this.h=c,this.s=!1)},i:function(a,b){a||(a=this.H||this.b,b=this.T||this.S);for(var f=l(this.O(),a,b),d=f.length;d--;){var e=
f[d][0];if(!f[d][1]||this.options.pullPlaceholder)if(e=this.containers[e],!e.disabled){if(!this.c()){var k=e.u();a=h(a,k);b=h(b,k)}if(e.i(a,b))return!0}}this.h&&(this.h=c)},g:function(a,b,c,d){var f=this.w;!d&&f&&f[0]===b[0]||(b[c](this.placeholder),this.w=b,this.h=d,this.options.afterMove(this.placeholder,a,b))},O:function(){return this.l||g(this.containers,this.l=[],this.options.tolerance,!this.c()),this.l},N:function(a){return a.closest(this.options.containerSelector).data("sortable")},c:function(){if(this.offsetParent===
c){var a=this.containers.length-1,b=this.containers[a].u();if(!this.options.a)for(;a--;)if(b[0]!=this.containers[a].u()[0]){b=!1;break}this.offsetParent=b}return this.offsetParent},I:function(a){a=this.v(a);if(this.c()){var b=h(a,this.c());this.T=this.H;this.H=b}this.S=this.b;this.b=a},M:function(a){a=this.v(a);return Math.max(Math.abs(this.b.left-a.left),Math.abs(this.b.top-a.top))>=this.options.distance},v:function(a){var b=a.originalEvent||a.originalEvent.touches&&a.originalEvent.touches[0];return{left:a.pageX||
b.pageX,top:a.pageY||b.pageY}},U:function(){var a=this;(this.m=!this.options.delay)||(clearTimeout(this.L),this.L=setTimeout(function(){a.m=!0},this.options.delay))},scroll:function(){this.A();this.B()},J:function(b){var c=this;a.each(["drag","drop","scroll"],function(a,f){c.K[b](u[f],c[f+"Proxy"])})},B:function(){this.offsetParent=c},A:function(){this.traverse(function(a){a._clearDimensions()})},traverse:function(a){a(this);for(var b=this.containers.length;b--;)this.containers[b].traverse(a)},_clearDimensions:function(){this.l=
c},_destroy:function(){q[this.options.group]=c}};p.prototype={o:function(a){var b=this.a;!this.disabled&&!b.C&&this.options.drag&&this.R(a)&&b.o(a,this)},R:function(a){return 1==a.which||"touchstart"==a.type&&1==a.originalEvent.touches.length},i:function(a,b){var c=l(this.P(),a,b),f=c.length,d=this.a,e=!d.options.isValidTarget||d.options.isValidTarget(d.item,this);if(!f&&e)return d.g(this,this.target,"append"),!0;for(;f--;)if(d=c[f][0],!c[f][1]&&this.F(d)){if(this.D(d).i(a,b))return!0}else if(e)return this.g(d,
a),!0},g:function(b,c){var d=a(this.items[b]),f=this.f[b],e="after",g=d.outerWidth(),h=d.outerHeight(),k=d.offset(),k={left:k.left,right:k.left+g,top:k.top,bottom:k.top+h};this.options.vertical?c.top<=(f[2]+f[3])/2?(e="before",k.bottom-=h/2):k.top+=h/2:c.left<=(f[0]+f[1])/2?(e="before",k.right-=g/2):k.left+=g/2;this.F(b)&&(k=x);this.a.g(this,d,e,k)},P:function(){return this.f||(this.items=this.j(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+
")").get(),g(this.items,this.f=[],this.options.tolerance)),this.f},u:function(){var a=this.el;return"relative"===a.css("position")||"absolute"===a.css("position")||"fixed"===a.css("position")?a:a.offsetParent()},F:function(a){return this.options.nested&&this.D(a)},D:function(b){var d=a.data(this.items[b],"subContainers");if(d===c){var f=this.j(this.items[b],"container");if(d=!1,f[0])d=a.extend({},this.options,{a:this.a,group:t++}),d=f.sortable(d).data("sortable").group;a.data(this.items[b],"subContainers",
d)}return d},j:function(b,c){var d=this.a.options,f=d[c+"Path"],d=d[c+"Selector"];return b=a(b),f&&(b=b.find(f)),b.children(d)},_serialize:function(b,c){var d=this,f=this.j(b,c?"item":"container").not(this.options.exclude).map(function(){return d._serialize(a(this),!c)}).get();return this.a.options.serialize(b,f,c)},traverse:function(b){a.each(this.items||[],function(){var c=a.data(this,"subContainers");c&&c.traverse(b)});b(this)},_clearDimensions:function(){this.f=c},_destroy:function(){var b=this;
this.target.off(u.start,this.handle);this.el.removeData("sortable");this.options.drop&&(this.group.containers=a.grep(this.group.containers,function(a){return a!=b}));a.each(this.items||[],function(){a.removeData(this,"subContainers")})}};var v={enable:function(){this.traverse(function(a){a.disabled=!1})},disable:function(){this.traverse(function(a){a.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(a){a._clearDimensions()})},destroy:function(){this.traverse(function(a){a._destroy()})}};
a.extend(p.prototype,v);a.fn.sortable=function(b){var d=Array.prototype.slice.call(arguments,1);return this.map(function(){var e=a(this),f=e.data("sortable");return f&&v[b]?v[b].apply(f,d)||this:(f||b!==c&&"object"!=typeof b||e.data("sortable",new p(e,b)),this)})}}(jQuery);var A,B,v,u,p;return e[45](function(){q()}),e[14](function(){A||(A=document.importNode(a("#critical-css-files-file")[0].content,!0));B||(B=document.importNode(a("#critical-css-files-auto")[0].content,!0));v||(v=document.importNode(a("#critical-css-files-error")[0].content,
!0));a("#critical-css-files > template").remove();e[15](function(){function b(b){var c=a("#criticalcss_editor select")[0].selectize.getValue();""!==c?(/\?/.test(c)?c+="&":c+="?",D.open(c+"o10n-css=1"+(b?"#editor":""),"o10n-css")):a("#criticalcss_editor select")[0].selectize.open()}function l(){a("#add_critical_css_file_form").show();a("html, body").animate({scrollTop:a("#add_critical_css_file_form").offset().top-200},200)}a("#critical-css-files").sortable({containerSelector:"tbody",itemPath:"",handle:"span.grip",
itemSelector:"tr",placeholder:'<tr class="placeholder"><td colspan="3" style="border-bottom-color:'+e[33]()+'">&nbsp;</td></tr>',onDrop:function(b,c){b.removeClass(c.group.options.draggedClass).removeAttr("style");a("body").removeClass(c.group.options.bodyClass);var d=b.prev(),e=b.next();if(d.length){var h=parseInt(a(".priority input",d).val());isNaN(h)&&(h=1);d=h+1;a(".priority input",b).val(d)}else d=parseInt(a(".priority input",b).val()),isNaN(d)&&(d=1),e.length&&(d=(h=parseInt(a(".priority input",
e).val()))<d&&1<h?h-1:h,a(".priority input",b).val(d));if(e.length&&(h=parseInt(a(".priority input",e).val()),isNaN(h)&&(h=1),h<=d))for(h=d;e.length;)h++,a(".priority input",e).val()<h&&a(".priority input",e).val(h),e=e.next();q(a(".priority input",b))}});a("#add_critical_css_file").on("click",function(){a("#add_critical_css_file_form").toggle(0,function(){a("#add_critical_css_file_form").is(":visible")&&l()})});a("#add_critical_css_file_form .submit .add").on("click",x);a("#add_critical_css_file_form .submit .add-edit").on("click",
x);a("#add_critical_css_file_form input").on("keypress",function(a){"13"==(a.keyCode?a.keyCode:a.which)&&(a.preventDefault(),x.call(this))});a("#critical-css-files").on("click",".options .delete",I);a("#critical-css-files").on("click","a.conditions",H);a("#critical-css-files").on("change",".priority input",function(){q(a(this))});a("#critical-css-files-empty a.add").on("click",function(){l()});a("#critical_css_conditions_container .cancel").on("click",function(){r()});a("#critical_css_conditions_container .save").on("click",
G);a("#criticalcss_editor .splitview").on("click",function(){b()});a("#criticalcss_editor .editor").on("click",function(){b(!0)})})}),F});